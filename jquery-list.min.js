!function(t){var i=function(i){i&&t.extend(this,i),this.initialize()};t.extend(i.prototype,{$el:null,$container:t(window),$content:t(document),scrollOffset:40,template:null,url:null,ajax:{},localData:!1,$loading:null,loadingMsg:"努力加载中...",$finished:null,finishedMsg:"加载完毕",hideFinished:!0,$empty:null,emptyMsg:"暂无数据",page:1,filterExitingData:!0,filterKey:"id",filterData:{},beforeLoad:null,afterLoad:null,afterRender:null,initialize:function(){this.localData?this.localData.data.length?(this.render(this.localData.data),this._isLastPage(this.localData)||this.scroll()):this.showEmpty():this.loadData(function(){})},scroll:function(){var t=this,i=!1;t.$container.scroll(function(){t.$finished||t.$content.height()<=t.$container.height()+t.$container.scrollTop()+t.scrollOffset&&0==i&&(i=!0,t.loadData(function(){i=!1}))})},loadData:function(i){var e=this;this.page+=1,this.showLoading(),this.beforeLoad&&this.beforeLoad(this),t.ajax(t.extend({url:this.url,data:{page:this.page},dataType:"json",success:function(t){e.hideLoading(),e.render(t.data),e._isLastPage(t)&&e.showFinished(),i&&i(),e.afterLoad&&e.afterLoad(e,t)}},this.ajax))},_isLastPage:function(t){return(t.page-1)*t.rows+t.data.length==t.records},showLoading:function(){this.$loading||(this.$loading=t('<div class="list-loading">'+this.loadingMsg+"</div>"),this.$loading.insertAfter(this.$el)),this.$loading.show()},hideLoading:function(){this.$loading.hide()},showFinished:function(){var i=this;this.$finished||(this.$finished=t('<div class="list-finished">'+this.finishedMsg+"</div>"),this.$finished.insertAfter(this.$el)),this.$finished.show(),this.hideFinished&&setTimeout(function(){i.$finished.hide()},2e3)},showEmpty:function(){this.$empty||(this.$empty=t('<div class="list-empty">'+this.emptyMsg+"</div>"),this.$empty.insertAfter(this.$el))},render:function(i){for(var e in i){if(this.filterExitingData){if("undefined"!=typeof this.filterData[i[e][this.filterKey]])continue;this.filterData[i[e][this.filterKey]]=!0}var s=t(t.trim(this.template(i[e])));s.data("list-data",i[e]),this.$el.append(s),this.afterRender&&this.afterRender(s)}},destroy:function(){this.$el.html(""),this.$el.removeData("list"),this.$empty&&this.$empty.remove(),this.$loading&&this.$loading.remove()},filter:function(i){this.$el.html(""),this.page=0,this.url=t.appendUrl(this.url,i),this.loadData(function(){})}}),t.fn.list=function(e){var s=arguments;return this.each(function(){var a=t(this),n=a.data("list"),h="object"==typeof e?e:{};if(h.$el=a,n?t.extend(n,h):a.data("list",n=new i(h)),"string"==typeof e){var l=[];for(var o in s)0!=o&&l.push(s[o]);n[e].apply(n,l)}})},t.fn.list.Constructor=i}($);